<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nearest Hospitals - Delhi AQI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        .nav-links {
            text-align: center;
            margin-bottom: 20px;
        }
        .nav-links a {
            margin: 0 10px;
            color: #11998e;
            text-decoration: none;
            font-weight: 600;
        }
        .nav-links a:hover {
            text-decoration: underline;
        }
        .hamburger-menu {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            cursor: pointer;
            background: white;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .hamburger-menu span {
            display: block;
            width: 25px;
            height: 3px;
            background: #11998e;
            margin: 3px 0;
            border-radius: 3px;
        }
        .side-menu {
            position: fixed;
            left: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 15px rgba(0,0,0,0.3);
            z-index: 999;
            transition: 0.3s;
            padding: 80px 0 20px 0;
        }
        .side-menu.active {
            left: 0;
        }
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 998;
            display: none;
        }
        .menu-overlay.active {
            display: block;
        }
        .menu-item {
            display: block;
            padding: 20px 30px;
            color: #333;
            text-decoration: none;
            border-left: 4px solid transparent;
            transition: 0.3s;
        }
        .menu-item:hover {
            background: #f5f5f5;
            border-left-color: #11998e;
        }
        #map {
            height: 300px;
            border-radius: 10px;
            margin: 20px 0;
            background: #e0e0e0;
        }
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            opacity: 0.9;
        }
        #hospitals {
            margin-top: 20px;
        }
        .hospital-item {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #11998e;
        }
        .hospital-name {
            font-weight: bold;
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
        }
        .hospital-address {
            color: #666;
            margin-bottom: 5px;
        }
        .hospital-distance {
            color: #11998e;
            font-weight: bold;
        }
        .share-btn {
            display: inline-block;
            padding: 8px 15px;
            background: #4285f4;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 14px;
        }
        .share-btn:hover {
            background: #357ae8;
        }
        #status {
            text-align: center;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            margin: 15px 0;
        }
        .api-note {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="hamburger-menu" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
    </div>
    <div class="side-menu" id="sideMenu">
        <a href="/" class="menu-item">üè† Dashboard</a>
        <a href="/live-location" class="menu-item">üìç Live Location Alert</a>
        <a href="/hospitals" class="menu-item" style="background:#f0f4ff;border-left-color:#11998e;">üè• Nearest Hospitals</a>
    </div>
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
    <div class="container">
        <div class="nav-links">
            <a href="/">üè† Home</a>
            <a href="/live-location">üìç Live Alert</a>
            <a href="/hospitals">üè• Hospitals</a>
        </div>
        
        <h1>üè• Nearest Hospitals</h1>
        
        <div class="api-note">
            <strong>‚ö†Ô∏è Setup Required:</strong> This page requires a Google Maps API key. 
            Get your free key at <a href="https://console.cloud.google.com" target="_blank">console.cloud.google.com</a> 
            and enable "Places API" and "Maps JavaScript API".
        </div>
        
        <p id="status">üìç Click button to find hospitals near you</p>
        <div id="map"></div>
        <button onclick="findHospitals()">üîç Find Nearest Hospitals</button>
        <div id="hospitals"></div>
    </div>

    <script>
        let map;
        let userLat, userLng;
        let infoWindow;

        // Initialize map (will be called after API loads)
        function initMap() {
            // Default to Delhi center
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 28.6139, lng: 77.2090 },
                zoom: 12
            });
            infoWindow = new google.maps.InfoWindow();
        }

        function calculateDistance(lat1, lon1, lat2, lon2) {
            // Haversine formula for distance calculation
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return (R * c).toFixed(2); // Distance in km
        }

        function findHospitals() {
            document.getElementById('status').innerHTML = 'üîÑ Getting your location...';
            document.getElementById('hospitals').innerHTML = '';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLat = position.coords.latitude;
                        userLng = position.coords.longitude;
                        
                        document.getElementById('status').innerHTML = `‚úÖ Location found! Searching hospitals...`;
                        
                        // Center map on user location
                        const userLocation = { lat: userLat, lng: userLng };
                        map.setCenter(userLocation);
                        
                        // Add marker for user location
                        new google.maps.Marker({
                            position: userLocation,
                            map: map,
                            title: 'Your Location',
                            icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
                        });

                        // Search for nearby hospitals
                        const request = {
                            location: userLocation,
                            radius: '5000', // 5km radius
                            type: 'hospital'
                        };

                        const service = new google.maps.places.PlacesService(map);
                        service.nearbySearch(request, (results, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK && results.length > 0) {
                                document.getElementById('status').innerHTML = `‚úÖ Found ${results.length} hospitals nearby`;
                                
                                let html = '';
                                results.slice(0, 10).forEach((place, index) => {
                                    const lat = place.geometry.location.lat();
                                    const lng = place.geometry.location.lng();
                                    const distance = calculateDistance(userLat, userLng, lat, lng);
                                    
                                    // Add marker for hospital
                                    const marker = new google.maps.Marker({
                                        position: { lat, lng },
                                        map: map,
                                        title: place.name,
                                        label: (index + 1).toString()
                                    });
                                    
                                    // Add click listener to marker
                                    marker.addListener('click', () => {
                                        infoWindow.setContent(`<strong>${place.name}</strong><br>${place.vicinity}`);
                                        infoWindow.open(map, marker);
                                    });

                                    const googleMapsLink = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
                                    const shareLink = `https://maps.google.com/?q=${lat},${lng}`;
                                    
                                    html += `
                                        <div class="hospital-item">
                                            <div class="hospital-name">${index + 1}. ${place.name}</div>
                                            <div class="hospital-address">üìç ${place.vicinity}</div>
                                            <div class="hospital-distance">üìè Distance: ${distance} km</div>
                                            ${place.rating ? `<div style="color: #ffa500;">‚≠ê Rating: ${place.rating}/5</div>` : ''}
                                            <a href="${googleMapsLink}" target="_blank" class="share-btn">üó∫Ô∏è Open in Maps</a>
                                            <a href="whatsapp://send?text=Hospital: ${encodeURIComponent(place.name)}%0ALocation: ${shareLink}" class="share-btn" style="background: #25d366;">üì§ Share</a>
                                        </div>
                                    `;
                                });
                                
                                document.getElementById('hospitals').innerHTML = html;
                            } else {
                                document.getElementById('status').innerHTML = '‚ùå No hospitals found nearby';
                            }
                        });
                    },
                    error => {
                        document.getElementById('status').innerHTML = '‚ùå Could not get your location. Please enable location services.';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                document.getElementById('status').innerHTML = '‚ùå Geolocation is not supported by your browser';
     script>
        function toggleMenu() {
            document.getElementById('sideMenu').classList.toggle('active');
            document.getElementById('menuOverlay').classList.toggle('active');
        }
    </script>
    
    <       }
        }

        // Check if Google Maps API is loaded
        window.addEventListener('load', () => {
            if (typeof google === 'undefined') {
                document.getElementById('status').innerHTML = '‚ö†Ô∏è Google Maps API not loaded. Please add your API key to the script src in the HTML.';
            }
        });
    </script>
    
    <!-- Replace YOUR_GOOGLE_API_KEY with your actual API key from console.cloud.google.com -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_API_KEY&libraries=places&callback=initMap">
    </script>
</body>
</html>
