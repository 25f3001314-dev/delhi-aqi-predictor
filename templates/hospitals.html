<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nearest Hospitals - Delhi AQI</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
        }
        .nav-links {
            text-align: center;
            margin-bottom: 20px;
        }
        .nav-links a {
            margin: 0 10px;
            color: #11998e;
            text-decoration: none;
            font-weight: 600;
        }
        .nav-links a:hover {
            text-decoration: underline;
        }
        .hamburger-menu {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            cursor: pointer;
            background: white;
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .hamburger-menu span {
            display: block;
            width: 25px;
            height: 3px;
            background: #11998e;
            margin: 3px 0;
            border-radius: 3px;
        }
        .side-menu {
            position: fixed;
            left: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 15px rgba(0,0,0,0.3);
            z-index: 999;
            transition: 0.3s;
            padding: 80px 0 20px 0;
        }
        .side-menu.active {
            left: 0;
        }
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 998;
            display: none;
        }
        .menu-overlay.active {
            display: block;
        }
        .menu-item {
            display: block;
            padding: 20px 30px;
            color: #333;
            text-decoration: none;
            border-left: 4px solid transparent;
            transition: 0.3s;
        }
        .menu-item:hover {
            background: #f5f5f5;
            border-left-color: #11998e;
        }
        #map {
            height: 400px;
            border-radius: 10px;
            margin: 20px 0;
            background: #e0e0e0;
            z-index: 1;
        }
        button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            opacity: 0.9;
        }
        #hospitals {
            margin-top: 20px;
        }
        .hospital-item {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #11998e;
        }
        .hospital-name {
            font-weight: bold;
            font-size: 18px;
            color: #333;
            margin-bottom: 5px;
        }
        .hospital-address {
            color: #666;
            margin-bottom: 5px;
        }
        .hospital-distance {
            color: #11998e;
            font-weight: bold;
        }
        .share-btn {
            display: inline-block;
            padding: 8px 15px;
            background: #4285f4;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 14px;
        }
        .share-btn:hover {
            background: #357ae8;
        }
        #status {
            text-align: center;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 10px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="hamburger-menu" onclick="window.location.href='/'">
        <span></span>
        <span></span>
        <span></span>
    </div>
    <div class="side-menu" id="sideMenu">
        <a href="/" class="menu-item">üè† Dashboard</a>
        <a href="/live-location" class="menu-item">üìç Live Location Alert</a>
        <a href="/aqi-map" class="menu-item">üó∫Ô∏è AQI Map</a>
        <a href="/hospitals" class="menu-item" style="background:#f0f4ff;border-left-color:#11998e;">üè• Nearest Hospitals</a>
    </div>
    <div class="menu-overlay" id="menuOverlay" onclick="toggleMenu()"></div>
    <div class="container">
        <h1>üè• Nearest Hospitals</h1>
        
        <div id="nearestDistance" style="background: #fff3cd; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #ffc107; font-size: 20px; font-weight: bold; text-align: center; display: none; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            üè• Nearest Hospital: <span id="distanceValue">Calculating...</span>
        </div>
        
        <p id="status">üìç Finding hospitals near you...</p>
        <div id="map"></div>
        <div id="hospitals"></div>
    </div>

    <script>
        let map;
        let userLat = 28.6139, userLng = 77.2090; // Default Delhi center
        let markers = [];

        // Initialize OpenStreetMap
        function initMap() {
            map = L.map('map').setView([28.6139, 77.2090], 12);
            
            // Add OpenStreetMap tiles (Free!)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);
            
            // Auto-find hospitals on load
            setTimeout(findHospitals, 1000);
        }
        
        // Initialize map on load
        window.addEventListener('load', initMap);
        
        function calculateDistance(lat1, lon1, lat2, lon2) {
            // Haversine formula for distance calculation
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return (R * c).toFixed(2); // Distance in km
        }

        function findHospitals() {
            document.getElementById('status').innerHTML = 'üîÑ Getting your location...';
            document.getElementById('hospitals').innerHTML = '';
            
            // Clear existing markers
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        userLat = position.coords.latitude;
                        userLng = position.coords.longitude;
                        
                        document.getElementById('status').innerHTML = `‚úÖ Location found! Searching hospitals...`;
                        
                        // Center map on user location
                        map.setView([userLat, userLng], 13);
                        
                        // Add marker for user location (blue)
                        const userMarker = L.marker([userLat, userLng], {
                            icon: L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                popupAnchor: [1, -34],
                                shadowSize: [41, 41]
                            })
                        }).addTo(map);
                        userMarker.bindPopup('<b>Your Location</b>').openPopup();
                        markers.push(userMarker);

                        // Search for hospitals using Overpass API (Free!)
                        const radius = 5000; // 5km
                        const overpassQuery = `
                            [out:json];
                            (
                                node["amenity"="hospital"](around:${radius},${userLat},${userLng});
                                way["amenity"="hospital"](around:${radius},${userLat},${userLng});
                                node["amenity"="clinic"](around:${radius},${userLat},${userLng});
                            );
                            out center;
                        `;
                        
                        fetch('https://overpass-api.de/api/interpreter', {
                            method: 'POST',
                            body: overpassQuery
                        })
                        .then(response => response.json())
                        .then(data => {
                            const hospitals = data.elements;
                            
                            if (hospitals.length > 0) {
                                document.getElementById('status').innerHTML = `‚úÖ Found ${hospitals.length} hospitals nearby`;
                                
                                // Sort by distance
                                hospitals.forEach(h => {
                                    const lat = h.lat || h.center?.lat;
                                    const lon = h.lon || h.center?.lon;
                                    h.distance = calculateDistance(userLat, userLng, lat, lon);
                                });
                                hospitals.sort((a, b) => parseFloat(a.distance) - parseFloat(b.distance));
                                
                                // Show nearest hospital distance
                                const nearestHospital = hospitals[0];
                                const nearestName = nearestHospital.tags?.name || 'Nearest Hospital';
                                document.getElementById('nearestDistance').style.display = 'block';
                                document.getElementById('distanceValue').innerHTML = `${nearestHospital.distance} km away - ${nearestName}`;
                                
                                let html = '';
                                hospitals.slice(0, 15).forEach((place, index) => {
                                    const lat = place.lat || place.center?.lat;
                                    const lon = place.lon || place.center?.lon;
                                    const name = place.tags?.name || `Hospital ${index + 1}`;
                                    const address = place.tags?.['addr:street'] || place.tags?.['addr:city'] || 'Address not available';
                                    
                                    // Add red marker for hospital
                                    const marker = L.marker([lat, lon], {
                                        icon: L.icon({
                                            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
                                            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                                            iconSize: [25, 41],
                                            iconAnchor: [12, 41],
                                            popupAnchor: [1, -34],
                                            shadowSize: [41, 41]
                                        })
                                    }).addTo(map);
                                    
                                    marker.bindPopup(`<b>${name}</b><br>${address}<br>Distance: ${place.distance} km`);
                                    markers.push(marker);

                                    const googleMapsLink = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
                                    const shareLink = `https://maps.google.com/?q=${lat},${lon}`;
                                    
                                    // Extract additional info if available
                                    const phone = place.tags?.phone || place.tags?.['contact:phone'] || '';
                                    const website = place.tags?.website || '';
                                    const emergency = place.tags?.emergency || '';
                                    const beds = place.tags?.beds || '';
                                    const operator = place.tags?.operator || '';
                                    
                                    html += `
                                        <div class="hospital-item">
                                            <div class="hospital-name">${index + 1}. ${name}</div>
                                            <div class="hospital-address">üìç ${address}</div>
                                            <div class="hospital-distance">üìè Distance: ${place.distance} km</div>
                                            ${phone ? `<div style="color: #666; margin-top: 5px;">üìû ${phone}</div>` : ''}
                                            ${operator ? `<div style="color: #666; margin-top: 5px;">üè• ${operator}</div>` : ''}
                                            ${beds ? `<div style="color: #666; margin-top: 5px;">üõèÔ∏è Beds: ${beds}</div>` : ''}
                                            ${emergency === 'yes' ? `<div style="color: #f44336; font-weight: bold; margin-top: 5px;">üö® Emergency Available</div>` : ''}
                                            <a href="${googleMapsLink}" target="_blank" class="share-btn">üó∫Ô∏è Open in Maps</a>
                                            <a href="whatsapp://send?text=Hospital: ${encodeURIComponent(name)}%0ALocation: ${shareLink}" class="share-btn" style="background: #25d366;">üì§ Share</a>
                                        </div>
                                    `;
                                });
                                
                                document.getElementById('hospitals').innerHTML = html;
                            } else {
                                document.getElementById('status').innerHTML = '‚ùå No hospitals found nearby';
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            document.getElementById('status').innerHTML = '‚ùå Error searching for hospitals';
                        });
                    },
                    error => {
                        document.getElementById('status').innerHTML = '‚ùå Could not get your location. Please enable location services.';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                document.getElementById('status').innerHTML = '‚ùå Geolocation is not supported by your browser';
            }
        }
        
        function toggleMenu() {
            document.getElementById('sideMenu').classList.toggle('active');
            document.getElementById('menuOverlay').classList.toggle('active');
        }
    </script>
</body>
</html>
